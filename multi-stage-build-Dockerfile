# -------- Stage 1: Builder --------
FROM node:23.11.0-alpine3.21 AS builder

WORKDIR /home/build/

# Copy and install dependencies
COPY package*.json . 
RUN npm install

# Copy source files and build
COPY . .
RUN npm run build

# -------- Stage 2: Runner --------
FROM node:23.11.0-alpine3.21 AS runner

WORKDIR /home/my-app/

# Only copy built app and necessary files from builder
COPY --from=builder /home/build/dist ./dist
COPY --from=builder /home/build/package*.json ./

RUN npm install --omit=dev  # install only production deps

EXPOSE 3000

CMD [ "npm", "start" ]


# now note that only last stage is present in image and rest all are deleted and in this way image have necessary thing